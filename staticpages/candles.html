<!--HTML file that carrys out CRUD operations on a table of data-->

<html>
    <head>
        <title>View Candles</title>
    </head>
    <body>
        <h1>Candles</h1>
        <div><button id = "button-showCreate" onclick="showCreate()">Create a Candle</button></div>
        <div>
            <table border ="1" id="candleTable">
                <tr>
                    <th>id</th>
                    <th>Name</th>
                    <th>Colour</th>
                    <th>Height</th>
                    <th>Width</th>
                    <th>Scent</th>
                    <th>Price</th>
                    <th>Update</th>
                    <th>Delete</th>
                </tr>

                <tr id ="1">
                    <td>1</td>
                    <td>Berry Burst</td>
                    <td>Red</td>
                    <td>12</td>
                    <td>10</td>
                    <td>Strawberry and Raspberry</td>
                    <td>12</td>
                    <td><button onclick="showUpdate(this)">Update</button></td>
                    <td><button onclick="doDelete(this)">Delete</button></td>
                </tr>
            </table>


        </div>

        <div id='createUpdateForm' style="display: none">
            <h2><span id="createLabel">Create a</span> 
            <span id="updateLabel" style="display:none">Update this</span> Candle
            </h2>

            Id <input type="text" name="id"><br/>
            Name <input type="text" name="Name"><br/>
            Colour <input type="text" name="Colour"><br/>
            Height <input type="text" name="Height"><br/>
            Width <input type="text" name="Width"><br/>
            Scent <input type="text" name="Scent"><br/>
            Price <input type="number" name="Price"><br/>

            <span><button id= "button-doCreate" onclick="doCreate()">Create</button></span>
            <span><button id ="button-doUpdate" onclick="doUpdate()">Update</button></span>
            

        </div>

    </body>
    <script>
        function showCreate(){
            document.getElementById('createUpdateForm').style.display="block"
            document.getElementById('button-doCreate').style.display="block"
            document.getElementById('button-doUpdate').style.display="none"
            document.getElementById('createLabel').style.display="inline"
            document.getElementById('updateLabel').style.display="none"

            document.getElementById('button-showCreate').style.display="none"
            document.getElementById('candleTable').style.display="none"


        }
    
        function showUpdate(buttonElement){
            document.getElementById("createUpdateForm").style.display = "block"        
            document.getElementById("button-doCreate").style.display = "none"

            document.getElementById("button-doUpdate").style.display = "block"
            document.getElementById("createLabel").style.display = "none"
            document.getElementById("updateLabel").style.display = "inline"
    
            document.getElementById("button-showCreate").style.display = "none"
            document.getElementById("candleTable").style.display = "none"


            rowElement = buttonElement.parentNode.parentNode
            candle = getCandleFromRow(rowElement)
            populateFormWithCandle(candle)

        }

        // Function to show create button and table and hide the update button 
        function showViewAll(){
            document.getElementById('createUpdateForm').style.display="none"
            document.getElementById('button-showCreate').style.display="block"
            document.getElementById('candleTable').style.display="block"
        }

        // function to clear the inputted data from the form when a new candle is created 
        function clearForm(){
            var form = document.getElementById('createUpdateForm')
            form.querySelector('input[name="id"]').disabled = false
            form.querySelector('input[name="id"]').value =''
            form.querySelector('input[name="Name"]').value=''
            form.querySelector('input[name="Colour"]').value=''
            form.querySelector('input[name="Height"]').value=''
            form.querySelector('input[name="Width"]').value=''
            form.querySelector('input[name="Scent"]').value=''
            form.querySelector('input[name="Price"]').value=''
        }


        // Read in the new candle details 
        function getCandleFromForm(){
            var form = document.getElementById('createUpdateForm')
            var candle = {}
            candle.id = form.querySelector('input[name="id"]').value
            candle.Name = form.querySelector('input[name="Name"]').value
            candle.Colour = form.querySelector('input[name="Colour"]').value
            candle.Height = form.querySelector('input[name="Height"]').value
            candle.Width = form.querySelector('input[name="Width"]').value
            candle.Scent = form.querySelector('input[name="Scent"]').value
            candle.Price = form.querySelector('input[name="Price"]').value
            //console.log(JSON.stringify(candle))
        return candle
        }
        
        //Populate the form with the details of the new candle 
        function populateFormWithCandle(candle){
            var form = document.getElementById('createUpdateForm')
            form.querySelector('input[name="id"]').disabled = true
            form.querySelector('input[name="id"]').value = candle.id
            form.querySelector('input[name="Name"]').value= candle.Name
            form.querySelector('input[name="Colour"]').value= candle.Colour
            form.querySelector('input[name="Height"]').value= candle.Height
            form.querySelector('input[name="Width"]').value= candle.Width
            form.querySelector('input[name="Scent"]').value= candle.Scent
            form.querySelector('input[name="Price"]').value= candle.Price
        }


                //adding new cadnle data to the table 
        function addCandleToTable(candle){
            var tableElement = document.getElementById('candleTable')
            var rowElement = tableElement.insertRow(-1)
            
            rowElement.setAttribute('id',candle.id)


            var cell1 = rowElement.insertCell(0);
            cell1.innerHTML = candle.id
            var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = candle.Name
            var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = candle.Colour
            var cell4 = rowElement.insertCell(3);
            cell4.innerHTML = candle.Height
            var cell5 = rowElement.insertCell(4);
            cell5.innerHTML = candle.Width
            var cell6 = rowElement.insertCell(5);
            cell6.innerHTML = candle.Scent
            var cell7 = rowElement.insertCell(6);
            cell7.innerHTML = candle.Price
            var cell8 = rowElement.insertCell(7);
            cell8.innerHTML = '<button onclick="showUpdate(this)">Update</button>'
            var cell9 = rowElement.insertCell(8);
            cell9.innerHTML = '<button onclick=doDelete(this)>Delete</button>'
            }

            
        // Read in the cadnle data from the current row 
        function getCandleFromRow(rowElement){
            var candle ={}
            candle.id = rowElement.cells[0].firstChild.textContent
            candle.Name = rowElement.cells[1].firstChild.textContent
            candle.Colour= rowElement.cells[2].firstChild.textContent
            candle.Height = rowElement.cells[3].firstChild.textContent
            candle.Width = rowElement.cells[4].firstChild.textContent
            candle.Scent = rowElement.cells[5].firstChild.textContent
            candle.Price = rowElement.cells[6].firstChild.textContent
            return candle 
            }


        function setCandleInRow(rowElement, candle){
            rowElement.cells[0].firstChild.textContent= candle.id
            rowElement.cells[1].firstChild.textContent= candle.Name
            rowElement.cells[2].firstChild.textContent= candle.Colour
            rowElement.cells[3].firstChild.textContent= candle.Height
            rowElement.cells[4].firstChild.textContent= candle.Width
            rowElement.cells[5].firstChild.textContent= candle.Scent
            rowElement.cells[6].firstChild.textContent= candle.Price

            }

        function doCreate(){
            //Testing this works by printing to console 
            //console.log(candle)
            candle = getCandleFromForm()
            //Testing it works 
            console.log("Creating a candle")
            addCandleToTable(candle)
            showViewAll()
            clearForm()
            
        }


        function doUpdate(){
            candle = getCandleFromForm();
            var rowElement = document.getElementById(candle.id)
            setCandleInRow(rowElement,candle)

            showViewAll()
            clearForm()
            
        }

        // Delete candle from table
        function doDelete(buttonElement){
            var tableElement = document.getElementById('candleTable')
            var index = buttonElement.parentNode.parentNode.rowIndex;
            tableElement.deleteRow(index);
            }

    
    </script>
</html>